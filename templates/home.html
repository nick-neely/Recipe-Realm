{% extends "layout.html" %} {% block content %}
<h1>Recipe Realm</h1>
<p>
  Welcome to the recipe sharing platform. Find and share your favorite recipes
  here!
</p>

<!-- Search Form -->
<form method="GET" action="{{ url_for('home') }}">
  <div class="input-group mb-3">
    <input
      type="text"
      name="query"
      class="form-control"
      placeholder="Search for recipes..."
      value="{{ request.args.get('query', '') }}"
    />
    <div class="input-group-append">
      <button class="btn btn-outline-secondary" type="submit">Search</button>
    </div>
  </div>
</form>

<div class="row">
  {% for recipe in recipes.items %}
  <div class="col-md-4">
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">{{ recipe.title }}</h5>
        <p class="card-text">
          <small class="text-muted"
            >Posted by: {{ recipe.author.username }}</small
          >
        </p>
        <p class="card-text">
          {% if avg_ratings[recipe.id] %}
          <small class="text-muted"
            >Average Rating: {{ avg_ratings[recipe.id]|round(1) }}/5</small
          >
          {% endif %}
        </p>
        <p class="card-text">{{ recipe.ingredients|truncate(100, True) }}</p>
        {% if recipe.average_rating is not none %} {% endif %}
        <a
          href="{{ url_for('recipe_detail', recipe_id=recipe.id) }}"
          class="btn btn-primary"
          >View Recipe</a
        >
      </div>
    </div>
  </div>
  {% endfor %}

  <!-- Pagination Controls -->
{% if recipes.pages > 1 %}
<nav aria-label="Page navigation">
    <ul class="pagination">
        <!-- Previous Page Link -->
        <li class="page-item {% if not recipes.has_prev %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('home', page=recipes.prev_num) if recipes.has_prev else '#' }}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>
        
        <!-- Individual Page Links -->
        {% for page_num in recipes.iter_pages() %}
            <li class="page-item {% if page_num == recipes.page %}active{% endif %}">
                <a class="page-link" href="{{ url_for('home', page=page_num) }}">{{ page_num }}</a>
            </li>
        {% endfor %}

        <!-- Next Page Link -->
        <li class="page-item {% if not recipes.has_next %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('home', page=recipes.next_num) if recipes.has_next else '#' }}" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
            </a>
        </li>
    </ul>
</nav>
{% endif %}
</div>
{% endblock %}
